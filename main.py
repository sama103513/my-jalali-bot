import jdatetime
from datetime import datetime
from pyrogram import Client, filters
from pyrogram.types import Message

# ---------------------------------------------------------
# ุชูุธูุงุช ุฑุจุงุช
# ---------------------------------------------------------
# ุงู API ูุฑุจูุท ุจู ุงูพูฺฉุดู ุฑุณู ุชูฺฏุฑุงู ุงุณุช ู ุนููู ูโุจุงุดุฏ (ุจุฏูู ูุงุฒ ุจู ููุชุฑุดฺฉู)
API_ID = 2040
API_HASH = "b18441a1ff607e10a989891a5462e627"

# ---------------------------------------------------------
# ุชูฺฉู ุฑุจุงุช ุฎูุฏุชุงู ุฑุง ุงูุฌุง ูุงุฑุฏ ฺฉูุฏ (ุงุฎุชุตุงุต ุดูุง)
# ---------------------------------------------------------
BOT_TOKEN = "8029985300:AAF3vWFpwRZGO08tFpHDeBCpKRi-2iydGNE" 

# ูุงู ุจุฑุง ูุงู ูุดุณุช (Session) ุฑุจุงุช
APP_NAME = "my_jalali_bot"

# ---------------------------------------------------------
# ุงุฌุงุฏ ฺฉูุงูุช ุฑุจุงุช
# ---------------------------------------------------------
app = Client(
    name=APP_NAME,
    api_id=API_ID,
    api_hash=API_HASH,
    bot_token=BOT_TOKEN
)

# ---------------------------------------------------------
# ุชุงุจุน ุชุจุฏู ุชุงุฑุฎ ุจู ุดูุณ
# ---------------------------------------------------------
def get_persian_date():
    """
    ุชุงุฑุฎ ู ุณุงุนุช ูุนู ุณุณุชู ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู ู ุจู ูุฑูุช ุดูุณ ุจุฑูโฺฏุฑุฏุงูุฏ.
    ุฎุฑูุฌ ููููู: ูพูุฌุดูุจู ฑดฐณ/ฐฒ/ฐฑ
    """
    now = datetime.now()
    # ุชุจุฏู ุชุงุฑุฎ ููุงุฏ ุจู ุดูุณ
    j_date = jdatetime.date.fromgregorian(date=now)
    # ุฏุฑุงูุช ูุงู ุฑูุฒ ููุชู
    day_name = j_date.strftime("%A")
    # ูุฑูุชโุจูุฏ ููุง
    formatted_date = f"{day_name} {j_date.jyear}/{j_date.jmonth:02d}/{j_date.jday:02d}"
    return formatted_date

# ---------------------------------------------------------
# ุฏุณุชูุฑ ุดุฑูุน
# ---------------------------------------------------------
@app.on_message(filters.command("start"))
async def start(client: Client, message: Message):
    """
    ููุช ฺฉุงุฑุจุฑ /start ุฑุง ุจูุฑุณุชุฏ ุงุฌุฑุง ูโุดูุฏ.
    """
    await message.reply_text("๐ ุณูุงู! ูู ุฑุจุงุช ูุณุชู.\n\nูุฑ ูุชู ฺฉู ุจุฑุงู ุจูุฑุณุชุ ุชุงุฑุฎ ุดูุณ ู ุฑูุฒ ููุชู ุฑุง ุจู ูพุงู ุขู ุงุถุงูู ูโฺฉูู.")

# ---------------------------------------------------------
# ููุฏูุฑ ุงุตู ุจุฑุง ุฏุฑุงูุช ูุชู ู ุงูุฒูุฏู ุชุงุฑุฎ
# ---------------------------------------------------------
@app.on_message(filters.text & ~filters.command("start"))
async def footer_handler(client: Client, message: Message):
    """
    ููุช ฺฉุงุฑุจุฑ ูุชู (ุบุฑ ุงุฒ ุฏุณุชูุฑูุง) ุงุฑุณุงู ฺฉูุฏ ุงุฌุฑุง ูโุดูุฏ.
    """
    # ุฏุฑุงูุช ูุชู ุงุตู ูพุงู ฺฉุงุฑุจุฑ
    original_text = message.text
    
    # ุฏุฑุงูุช ุชุงุฑุฎ ุดูุณ
    date_str = get_persian_date()
    
    # ุงุถุงูู ฺฉุฑุฏู ุชุงุฑุฎ ุจู ุงูุชูุง ูุชู (ุจุง ุฏู ุฎุท ูุงุตูู)
    # ุดูุง ูโุชูุงูุฏ ูุชู ๐ ุฑุง ุชุบุฑ ุฏูุฏ ุง ุญุฐู ฺฉูุฏ
    new_text = f"{original_text}\n\n๐ {date_str}"
    
    # ุงุฑุณุงู ูพุงุณุฎ (ูพุงู ุฌุฏุฏ ุดุงูู ูุชู + ุชุงุฑุฎ)
    # ุงุณุชูุงุฏู ุงุฒ quote=True ุจุงุนุซ ูโุดูุฏ ูพุงู ุฏุฑ ุฌูุงุจ ูพุงู ฺฉุงุฑุจุฑ ุงุฑุณุงู ุดูุฏ
    await message.reply(new_text, quote=True)

# ---------------------------------------------------------
# ุงุฌุฑุง ุฑุจุงุช
# ---------------------------------------------------------
print("ุฑุจุงุช ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช...")
app.run()